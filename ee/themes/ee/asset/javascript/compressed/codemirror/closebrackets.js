!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(e,n){var t=e.getRange(l(n.line,n.ch-1),l(n.line,n.ch+1));return 2==t.length?t:null}function t(t){for(var r={name:"autoCloseBrackets",Backspace:function(r){if(r.getOption("disableInput"))return e.Pass;for(var i=r.listSelections(),a=0;a<i.length;a++){if(!i[a].empty())return e.Pass;var o=n(r,i[a].head);if(!o||t.indexOf(o)%2!=0)return e.Pass}for(var a=i.length-1;a>=0;a--){var s=i[a].head;r.replaceRange("",l(s.line,s.ch-1),l(s.line,s.ch+1))}}},i="",a=0;a<t.length;a+=2)(function(n,t){n!=t&&(i+=t),r["'"+n+"'"]=function(r){if(r.getOption("disableInput"))return e.Pass;for(var a,s,c=r.listSelections(),f=0;f<c.length;f++){var u,h=c[f],d=h.head;if("'"==n&&"comment"==r.getTokenTypeAt(d))return e.Pass;var s=r.getRange(d,l(d.line,d.ch+1));if(h.empty())if(n==t&&s==t)u=r.getRange(d,l(d.line,d.ch+3))==n+n+n?"skipThree":"skip";else if(n==t&&d.ch>1&&r.getRange(l(d.line,d.ch-2),d)==n+n&&(d.ch<=2||r.getRange(l(d.line,d.ch-3),l(d.line,d.ch-2))!=n))u="addFour";else{if(n==t&&e.isWordChar(s))return e.Pass;if(!(r.getLine(d.line).length==d.ch||i.indexOf(s)>=0||o.test(s)))return e.Pass;u="both"}else u="surround";if(a){if(a!=u)return e.Pass}else a=u}r.operation(function(){if("skip"==a)r.execCommand("goCharRight");else if("skipThree"==a)for(var e=0;e<3;e++)r.execCommand("goCharRight");else if("surround"==a){for(var i=r.getSelections(),e=0;e<i.length;e++)i[e]=n+i[e]+t;r.replaceSelections(i,"around")}else"both"==a?(r.replaceSelection(n+t,null),r.execCommand("goCharLeft")):"addFour"==a&&(r.replaceSelection(n+n+n+n,"before"),r.execCommand("goCharRight"))})},n!=t&&(r["'"+t+"'"]=function(n){for(var r=n.listSelections(),i=0;i<r.length;i++){var a=r[i];if(!a.empty()||n.getRange(a.head,l(a.head.line,a.head.ch+1))!=t)return e.Pass}n.execCommand("goCharRight")})})(t.charAt(a),t.charAt(a+1));return r}function r(t){return function(r){if(r.getOption("disableInput"))return e.Pass;for(var i=r.listSelections(),a=0;a<i.length;a++){if(!i[a].empty())return e.Pass;var o=n(r,i[a].head);if(!o||t.indexOf(o)%2!=0)return e.Pass}r.operation(function(){r.replaceSelection("\n\n",null),r.execCommand("goCharLeft"),i=r.listSelections();for(var e=0;e<i.length;e++){var n=i[e].head.line;r.indentLine(n,null,!0),r.indentLine(n+1,null,!0)}})}}var i="()[]{}''\"\"",a="[]{}",o=/\s/,l=e.Pos;e.defineOption("autoCloseBrackets",!1,function(n,o,l){if(l!=e.Init&&l&&n.removeKeyMap("autoCloseBrackets"),o){var s=i,c=a;"string"==typeof o?s=o:"object"==typeof o&&(null!=o.pairs&&(s=o.pairs),null!=o.explode&&(c=o.explode));var f=t(s);c&&(f.Enter=r(c)),n.addKeyMap(f)}})});