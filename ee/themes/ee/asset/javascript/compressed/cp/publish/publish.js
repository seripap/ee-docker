/*!
 * This source file is part of the open source project
 * ExpressionEngine (https://expressionengine.com)
 *
 * @link      https://expressionengine.com/
 * @copyright Copyright (c) 2003-2018, EllisLab, Inc. (https://ellislab.com)
 * @license   https://expressionengine.com/license Licensed under Apache License, Version 2.0
 */
$(document).ready(function(){function e(e,n){var a,o=this,r=arguments,s=function(){i=null,a=e.apply(o,r)};return clearTimeout(i),t&&t.abort(),i=setTimeout(s,n),a}var t,i,n=$("[data-publish] > form");if(1==EE.publish.title_focus&&n.find("input[name=title]").focus(),"new"==EE.publish.which&&n.find("input[name=title]").bind("keyup blur",function(){n.find("input[name=title]").ee_url_title(n.find("input[name=url_title]"))}),EE.publish.smileys===!0&&$(".format-options .toolbar .emoji a").click(function(e){$(this).parents(".format-options").find(".emoji-wrap").slideToggle("fast"),e.preventDefault()}),EE.publish.autosave&&EE.publish.autosave.interval){var a=!1;n.on("entry:startAutosave",function(){n.trigger("entry:autosave"),a||(a=!0,setTimeout(function(){$.ajax({type:"POST",dataType:"json",url:EE.publish.autosave.URL,data:n.serialize(),success:function(e){var t=$("[data-publish] .form-btns-top h1");t.find(".app-badge").remove(),e.error?console.log(e.error):e.success?t.append(e.success):console.log("Autosave Failed"),a=!1}})},1e3*EE.publish.autosave.interval))});var o=$("textarea, input").not(":password,:checkbox,:radio,:submit,:button,:hidden"),r=$("select, :checkbox, :radio, :file");o.on("keypress change",function(){n.trigger("entry:startAutosave")}),r.on("change",function(){n.trigger("entry:startAutosave")})}var s=function(){var e=$("iframe.live-preview__frame")[0],i=$(e).data("url"),a=$(".live-preview > .app-notice---important");a.removeClass("app-notice---important").addClass("app-notice---loading"),a.find("[data-loading]").removeClass("hidden"),a.find("[data-unpublished]").addClass("hidden"),a.find(".js-preview-wide").addClass("hidden"),t=$.ajax({type:"POST",dataType:"html",url:i,data:n.serialize(),complete:function(i){void 0!==i.responseText&&(e.contentDocument.open(),e.contentDocument.write(i.responseText),e.contentDocument.close(),a.removeClass("app-notice---loading").addClass("app-notice---important"),a.find("[data-loading]").addClass("hidden"),a.find("[data-unpublished]").removeClass("hidden"),a.find(".js-preview-wide").removeClass("hidden")),t=null}})};$(document).on("entry:preview",function(t,i){void 0==i&&(i=0),$(".app-modal--live-preview:visible").length&&e(s,i)}),$("body").on("click",'button[rel="live-preview"]',function(e){var t=$(".app-modal--live-preview .form-standard"),i=$("iframe.live-preview__frame")[0];i.contentDocument.open(),i.contentDocument.write(""),i.contentDocument.close(),s(),t.append($(n)),$(t).on("interact","input, textarea",function(e){$("body").trigger("entry:preview",[225])}),$(t).on("change","input[type=checkbox], input[type=radio], input[type=hidden], select",function(e){$(document).trigger("entry:preview")}),$(t).on("click","a.toggle-btn",function(e){$(document).trigger("entry:preview")}),$('button[rel="live-preview"]').hide(),$(document).trigger("entry:preview-open")}),$(".app-modal--live-preview").on("modal:close",function(e){$("[data-publish]").append($(".app-modal--live-preview .form-standard > form")),$('button[rel="live-preview"]').show(),$(document).trigger("entry:preview-close")}),window.location.search.includes("&preview=y")&&setTimeout(function(){$('button[rel="live-preview"]').click()},100),$(".js-preview-wide").on("click",function(){var e=$(this).text(),t=$(this).attr("data-close"),i=$(this).attr("data-open");$(".live-preview---open").toggleClass("live-preview--wide"),$(this).text(e==t?i:t)});var l=$('button[value="preview"]').hasClass("hidden"),p=function(e){var t=$('input[name="pages__pages_uri"]'),i=$('input[name="pages__pages_template_id"]'),n=$('button[value="preview"]');show=!1,show=""!=t.val()&&(""!=i.val()||"label"==e.target.nodeName.toLowerCase()),show&&n.removeClass("hidden"),!show&&l&&n.addClass("hidden")};$('input[name="pages__pages_uri"]').on("interact",p),$('div[data-input-value="pages__pages_template_id"] .field-inputs label').on("click",p),$("[data-publish] .form-btns button:disabled").removeAttr("disabled")});